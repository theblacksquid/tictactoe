// Generated by CoffeeScript 1.10.0
(function() {
  var Cell, Grid, Row, didPlayerWin, evalGame, game, getX, getY, grid, lineFromGrid, pointsEq, slope, turn;

  getX = function(pt) {
    return pt[0];
  };

  getY = function(pt) {
    return pt[1];
  };

  slope = function(point1, point2) {
    switch (false) {
      case (getY(point1) - getY(point2)) !== 0:
        return 'VERTICAL';
      case (getX(point1) - getX(point2)) !== 0:
        return 'HORIZONTAL';
      default:
        return (getY(point1) - getY(point2)) / (getX(point1) - getX(point2));
    }
  };

  lineFromGrid = function(grid, direction, start) {
    var cache, i, j, len, length, row;
    length = grid.length;
    cache = [];
    i = start;
    switch (false) {
      case direction !== 'HORIZONTAL':
        return grid[start];
      case direction !== 'VERTICAL':
        for (j = 0, len = grid.length; j < len; j++) {
          row = grid[j];
          cache.push(row[start]);
        }
        return cache;
      case direction !== 'DIAGONAL':
        while (length > i) {
          cache.push(grid[i][i]);
          i++;
        }
        return cache;
      case direction !== 'ANTI-DIAG':
        while (length > i) {
          cache.push(grid[i][(length - 1) - i]);
          i++;
        }
        return cache;
    }
  };

  pointsEq = function(lineArr) {
    var i;
    i = 0;
    while (lineArr.length > i) {
      if (lineArr[i] !== lineArr[0]) {
        return false;
      }
      i++;
    }
    return true;
  };

  didPlayerWin = function(player, gamestate) {
    var anti, arr, diag, horiz, i, item, j, len, vert;
    i = 0;
    while (gamestate.length > i) {
      horiz = lineFromGrid(gamestate, "HORIZONTAL", i);
      vert = lineFromGrid(gamestate, "VERTICAL", i);
      diag = lineFromGrid(gamestate, "DIAGONAL", 0);
      anti = lineFromGrid(gamestate, "ANTI-DIAG", 0);
      arr = [horiz, vert, diag, anti];
      for (j = 0, len = arr.length; j < len; j++) {
        item = arr[j];
        if ((pointsEq(item) === true) && (item[0] === player)) {
          return true;
        }
      }
      i++;
    }
    return false;
  };

  evalGame = function(gamestate, player1, player2) {
    var cells, non_null;
    non_null = [].concat.apply([], gamestate).filter(function(x) {
      if (x !== void 0 || "" || null) {
        return true;
      }
    });
    cells = [].concat.apply([], gamestate).length;
    if (didPlayerWin(player1, gamestate)) {
      return player1 + " wins";
    } else if (didPlayerWin(player2, gamestate)) {
      return player2 + " wins";
    } else if (non_null.length === cells) {
      return "DRAW";
    } else {
      return "CONTINUE";
    }
  };

  game = [["X", "O", "X"], ["X", "O", "O"], ["O", "X", "X"]];

  console.log(evalGame(game, "X", "O"));

  turn = 1;

  Cell = (function() {
    function Cell(el, col, row1) {
      this.el = el;
      this.col = col;
      this.row = row1;
      this.status = 'unclaimed';
      this.id = "cell-" + this.row + "-" + this.col;
    }

    Cell.prototype.template = function() {
      return "        <div class='cell' id='cell-" + this.row + "-" + this.col + "' style='display: inline-block'>\n	<img id='cell-" + this.row + "-" + this.col + "-img' src='icons/ic_crop_din_black_24dp/web/ic_crop_din_black_24dp_2x.png' />\n</div>";
    };

    Cell.prototype.render = function() {
      $(this.el).append(this.template());
      return this.onClick();
    };

    Cell.prototype.onClick = function() {
      var self;
      self = this;
      return $("#cell-" + this.row + "-" + this.col + "-img").click(function() {
        if (self.status === 'unclaimed') {
          if ((turn % 2) === 0) {
            self.status = 'claimed-X';
            $("#cell-" + self.row + "-" + self.col + "-img").attr("src", "icons/ic_block_black_24dp/web/ic_block_black_24dp_2x.png");
            return turn++;
          } else {
            self.status = 'claimed-O';
            $("#cell-" + self.row + "-" + self.col + "-img").attr("src", "icons/ic_clear_black_24dp/web/ic_clear_black_24dp_2x.png");
            return turn++;
          }
        } else {
          return console.log("claimed cell clicked");
        }
      });
    };

    return Cell;

  })();

  Row = (function() {
    function Row(el, rownum, numcells) {
      this.el = el;
      this.rownum = rownum;
      this.numcells = numcells;
      this.cells = [];
      this.id = "row-" + this.rownum;
    }

    Row.prototype.template = function() {
      return "<div id='row-" + this.rownum + "'>\n</div>";
    };

    Row.prototype.render = function() {
      $(this.el).append(this.template());
      return this.generateCells(this.numcells);
    };

    Row.prototype.generateCells = function(cellnums) {
      var cell, i, results;
      i = 0;
      results = [];
      while (cellnums > i) {
        cell = new Cell("#row-" + this.rownum, this.rownum, i);
        this.cells.push(cell);
        cell.render();
        results.push(i++);
      }
      return results;
    };

    return Row;

  })();

  Grid = (function() {
    function Grid(el, numrows) {
      this.el = el;
      this.numrows = numrows;
      this.rows = [];
    }

    Grid.prototype.template = function() {
      return "<div id='game-grid'>\n</div>";
    };

    Grid.prototype.render = function() {
      $(this.el).append(this.template());
      return this.generateRows(this.numrows);
    };

    Grid.prototype.generateRows = function(rownums) {
      var i, results, row;
      i = 0;
      results = [];
      while (rownums > i) {
        row = new Row("#game-grid", i, rownums);
        this.rows.push(row);
        row.render();
        results.push(i++);
      }
      return results;
    };

    return Grid;

  })();

  grid = new Grid("#app", 6);

  grid.render();

}).call(this);
